# BLAST+ è›‹ç™½è´¨åŒæºæ˜ å°„æµç¨‹

## ğŸ“ æ–‡ä»¶ç»“æ„

```
å·¥ä½œç›®å½•/
â”œâ”€â”€ 01_run_blast.sh                              # Step1: BLASTæ¯”å¯¹è„šæœ¬
â”œâ”€â”€ 02_LR_mapping.R                              # Step2: Ræ˜ å°„è„šæœ¬
â”œâ”€â”€ Athaliana_167_protein_primaryTranscriptOnly.fa   # è¾“å…¥: æ‹Ÿå—èŠ¥è›‹ç™½è´¨ç»„
â”œâ”€â”€ Ptrichocarpa_533_v4.1.protein.fa             # è¾“å…¥: æ¨æ ‘è›‹ç™½è´¨ç»„
â”œâ”€â”€ LR_pair_ath.csv                              # è¾“å…¥: æ‹Ÿå—èŠ¥L-Rå¯¹
â”œâ”€â”€ blast_db/                                    # BLASTæ•°æ®åº“
â”‚   â””â”€â”€ ptr_protein.*
â”œâ”€â”€ blast_output/                                # BLASTè¾“å‡º
â”‚   â””â”€â”€ ath_vs_ptr.txt
â””â”€â”€ results/                                     # æœ€ç»ˆç»“æœ
    â”œâ”€â”€ LR_pair_Ptrichocarpa.csv                 # â˜… æœ€ç»ˆæ¨æ ‘L-Rå¯¹
    â”œâ”€â”€ LR_pair_ptr_clean.csv                    # ç®€æ´ç‰ˆ(å«æ‹Ÿå—èŠ¥å¯¹åº”)
    â”œâ”€â”€ LR_pair_ptr_full.csv                     # å®Œæ•´ç‰ˆ(å«æ‰€æœ‰æ¯”å¯¹ä¿¡æ¯)
    â”œâ”€â”€ ortholog_mapping_table.csv               # åŒæºåŸºå› æ˜ å°„è¡¨
    â”œâ”€â”€ unmapped_ligands.txt                     # æœªæ˜ å°„Ligand
    â”œâ”€â”€ unmapped_receptors.txt                   # æœªæ˜ å°„Receptor
    â””â”€â”€ mapping_report.txt                       # æ˜ å°„æŠ¥å‘Š
```

## ğŸš€ è¿è¡Œæ­¥éª¤

### Step 1: è¿è¡ŒBLASTæ¯”å¯¹

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x 01_run_blast.sh

# è¿è¡ŒBLAST
./01_run_blast.sh
```

**å¯è°ƒå‚æ•°** (åœ¨è„šæœ¬ä¸­ä¿®æ”¹):
- `EVALUE="1e-10"` - E-valueé˜ˆå€¼
- `NUM_THREADS=8` - å¹¶è¡Œçº¿ç¨‹æ•°
- `MAX_TARGET_SEQS=10` - æ¯ä¸ªqueryä¿ç•™çš„æœ€å¤§åŒ¹é…æ•°

### Step 2: è¿è¡ŒRæ˜ å°„è„šæœ¬

```bash
Rscript 02_LR_mapping.R
```

**å¯è°ƒå‚æ•°** (åœ¨Rè„šæœ¬paramsåˆ—è¡¨ä¸­ä¿®æ”¹):
```r
params <- list(
  evalue_cutoff   = 1e-10,   # E-valueé˜ˆå€¼
  identity_cutoff = 30,      # åºåˆ—ä¸€è‡´æ€§é˜ˆå€¼ (%)
  coverage_cutoff = 50       # æŸ¥è¯¢è¦†ç›–åº¦é˜ˆå€¼ (%)
)
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `LR_pair_Ptrichocarpa.csv` | çº¯æ¨æ ‘L-Rå¯¹ | **ç›´æ¥ç”¨äºä¸‹æ¸¸åˆ†æ** |
| `LR_pair_ptr_clean.csv` | å«æ‹Ÿå—èŠ¥å¯¹åº”ID | è¿½æº¯æ˜ å°„æ¥æº |
| `LR_pair_ptr_full.csv` | å®Œæ•´æ¯”å¯¹ä¿¡æ¯ | è¯„ä¼°æ˜ å°„è´¨é‡ |
| `ortholog_mapping_table.csv` | æ‰€æœ‰åŒæºåŸºå› å¯¹ | å…¶ä»–åˆ†æä½¿ç”¨ |

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. L-Ræ–‡ä»¶æ ¼å¼è¦æ±‚
ç¡®ä¿ `LR_pair_ath.csv` æ ¼å¼æ­£ç¡®:
```csv
Ligand,Receptor
AT1G01010,AT2G02020
AT3G03030,AT4G04040
```
- ç¬¬1åˆ—: LigandåŸºå› ID
- ç¬¬2åˆ—: ReceptoråŸºå› ID
- å¯ä»¥æœ‰é¢å¤–åˆ—,ä¸å½±å“å¤„ç†

### 2. åŸºå› IDæ ¼å¼
è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†ä»¥ä¸‹IDæ ¼å¼:
- æ‹Ÿå—èŠ¥: `AT1G01010.1|PACid:xxx` â†’ `AT1G01010`
- æ¨æ ‘: `Potri.001G000100.1.p` â†’ `Potri.001G000100`

å¦‚æœä½ çš„IDæ ¼å¼ä¸åŒ,è¯·ä¿®æ”¹Rè„šæœ¬ä¸­çš„æ¸…æ´—ä»£ç (Step 3éƒ¨åˆ†)

### 3. é˜ˆå€¼é€‰æ‹©å»ºè®®

| ä¸¥æ ¼ç¨‹åº¦ | Identity | Coverage | E-value | é€‚ç”¨åœºæ™¯ |
|----------|----------|----------|---------|----------|
| å®½æ¾ | â‰¥25% | â‰¥40% | 1e-5 | æ¢ç´¢æ€§åˆ†æ |
| **é»˜è®¤** | **â‰¥30%** | **â‰¥50%** | **1e-10** | **ä¸€èˆ¬ç ”ç©¶** |
| ä¸¥æ ¼ | â‰¥40% | â‰¥60% | 1e-20 | é«˜ç½®ä¿¡åº¦åˆ†æ |

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: æ˜ å°„ç‡å¤ªä½æ€ä¹ˆåŠ?
1. é™ä½Identityå’ŒCoverageé˜ˆå€¼
2. æ£€æŸ¥åŸºå› IDæ ¼å¼æ˜¯å¦åŒ¹é…
3. éƒ¨åˆ†åŸºå› å¯èƒ½çœŸçš„æ²¡æœ‰åŒæºåŸºå› 

### Q2: å¦‚ä½•è·å–åŒå‘æœ€ä½³åŒ¹é…(RBH)?
åœ¨Rè„šæœ¬ä¸­æ·»åŠ åå‘BLASTå¹¶å–äº¤é›†,è¿™æ˜¯æ›´ä¸¥æ ¼çš„åŒæºåˆ¤å®šæ–¹æ³•ã€‚

### Q3: å¦‚ä½•å¤„ç†ä¸€å¯¹å¤šæ˜ å°„?
å½“å‰è„šæœ¬é€‰æ‹©bitscoreæœ€é«˜çš„ä½œä¸ºæœ€ä½³åŒ¹é…ã€‚å¦‚éœ€ä¿ç•™æ‰€æœ‰åŒ¹é…,ä¿®æ”¹Step 5ä¸­çš„`slice_head(n = 1)`ã€‚

## ğŸ“š ä¾èµ–è¦æ±‚

**ç³»ç»Ÿ:**
- BLAST+ (>= 2.10.0)

**RåŒ…:**
- tidyverse
- data.table

å®‰è£…RåŒ…:
```r
install.packages(c("tidyverse", "data.table"))
```
